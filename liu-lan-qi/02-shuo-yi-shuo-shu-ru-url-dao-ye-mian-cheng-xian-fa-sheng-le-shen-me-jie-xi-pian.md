---
description: 拿到源文件后，我们还要根据文档内容解析成对应的DOM树结构
---

# 02说一说输入URL到页面呈现发生了什么-解析篇

终于到浓墨重彩的一步，浏览器有啥黑魔法，把我们编写的HTML文件变成我们能够看到的、能够浏览的页面，这里面究竟发生了什么，今天，我们就用魔法打败魔法！一探浏览器内部机制

![](../.gitbook/assets/image%20%2867%29.png)

## 1.构建DOM树（解析HTML）

我们编写的HTML文件，浏览器是看不懂的，就类型于编译器编译的过程一样，浏览器首先需要完成对HTML源文件的转换，生成DOM树，然后再进行其他操作。

![html&#x7684;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;](../.gitbook/assets/image%20%2866%29.png)

## 2.样式计算（解析CSS）

### 格式化CSS代码

我们编写的CSS,浏览器也看不太懂，而且还来源于多个地方行内、link、import，所以，浏览器需要先将所有的CSS代码给找出来，然后再进行统一的处理

通常 CSS 主要来自于这几

* 通过 link 引用的
* 外部 CSS 文件标记内的
*  CSS元素的 style 属性内嵌的 CSS

找出 CSS 后，就要进行处理了，具体的转换过程我没有仔细深入，大致操作和HTML转换成DOM树差不多，所有的CSS文件最后也会被转换成 **styleSheets**，可以通过document.styleSheets查看

### 标准化属性值

CSS的语法也很具有包容性，比如我们可以这样写`background-color: white`，也可以这样写`background-color:#ffffff`，还可以这样写`background-color：rag(0,0,0)`

之所以可以这样写，是因为浏览器最后还会对 CSS 代码进行标准化处理，`white` 和 `#ffffff`，最后都会被标准化为rgb格式`rgb(0,0,0)`

![](../.gitbook/assets/image%20%2874%29.png)

### 计算每个DOM节点的样式

样式已经被`格式化`和`标准化`,接下来就可以计算每个节点的具体样式信息了。

其实计算的方式也并不复杂，主要就是两个规则: **继承**和**层叠**。

每个子节点都会默认继承父节点的样式属性，如果父节点中没有找到，就会采用浏览器默认样式，也叫`UserAgent样式`。这就是继承规则，非常容易理解。

然后是层叠规则，CSS 最大的特点在于它的层叠性，也就是最终的样式取决于各个属性共同作用的效果，甚至有很多诡异的层叠现象，看过《CSS世界》的同学应该对此深有体会，具体的层叠规则属于深入 CSS 语言的范畴，这里就不过多介绍了。

![](../.gitbook/assets/image%20%2872%29.png)

## 3.生成布局树

经过上面的样式计算，现在我们已经能够清楚的得知每个DOM节点的样式是怎么了，但是这还不够，我们还不知道每个DOM节点的位置，所以我们还需要继续算出布局树

布局树生成的大致工作如下:

1. 遍历生成的 DOM 树节点，并把他们添加到`布局树中`。
2. 计算布局树节点的坐标位置。

值得注意的是，这棵布局树值包含可见元素，对于 `head`标签和设置了`display: none`的元素，将不会被放入其中。

## 总结

文章脉络

![](../.gitbook/assets/image%20%2864%29.png)



